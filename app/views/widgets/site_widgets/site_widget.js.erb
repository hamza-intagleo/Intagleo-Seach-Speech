var hostUrl = "http://localhost:3000/";
var libraries = 0;
var widget_date_format = 'MM/dd/yyyy'

function appendJSLibrary( url, callback ) {
  var script = document.createElement( "script" )
  script.type = "text/javascript";
  if(script.readyState) {  //IE
    script.onreadystatechange = function() {
      if ( script.readyState === "loaded" || script.readyState === "complete" ) {
        script.onreadystatechange = null;
        callback();
      }
    };
  } else {  //Others
    script.onload = function() {
      callback();
    };
  }

  script.src = url;
  document.body.appendChild( script );
}

function libraryAdded(){
  libraries+= 1;
}

function allLibrariesAdded(){
  if(libraries >= 6){
    return true;
  }
  return false;
}

var addCSSLibrary = function(url){
  var cssFileURL = url;
  var cssTag  = document.createElement('link');
  cssTag.rel  = 'stylesheet';
  cssTag.type = 'text/css';
  cssTag.href = cssFileURL;
  document.head.appendChild(cssTag);
}

var setJSLibraries = function() {
  // Load the script
  if(typeof(jQuery) == 'undefined'){
    var script = document.createElement("SCRIPT");
    script.src = 'https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js';
    script.type = 'text/javascript';
    document.getElementsByTagName("head")[0].appendChild(script);
  }

  // Poll for jQuery to come into existance
  var checkReady = function(callback) {
    if (window.jQuery) {
      callback(jQuery);
    }
    else {
      window.setTimeout(function() { checkReady(callback); }, 20);
    }
  };

  // Start polling...
  checkReady(function($) {
    $(function() {
      // jQuery is loaded!
      // Load Bootstrap JS
      appendJSLibrary("https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js", function() {
        libraryAdded();
      });
    });
  });
}

var setCSSLibraries = function() {

  // Load Font Family CSS
  addCSSLibrary("https://fonts.googleapis.com/css?family=Lato:400,700,300");
}

var getWidget = function(searchWidget) {
  setJSLibraries();
  setCSSLibraries();
  document.getElementById(searchWidget.widgetTarget).innerHTML = "<%= escape_javascript(render(:partial => 'site_widget')) %>";
  

  if(typeof searchWidget.url !== 'undefined' && searchWidget.url.length != 0){
    target_url = searchWidget.url = (searchWidget.url.indexOf('://') === -1) ? 'http://' + searchWidget.url : searchWidget.url;
    document.getElementById('search_form_hotel').action = target_url+"/search/result";
  }


}

/* Load widget on page load */
if( document.addEventListener ) {
  document.addEventListener('load', getWidget(searchWidget))
} else {
  document.attachEvent('onload', getWidget(searchWidget))
}